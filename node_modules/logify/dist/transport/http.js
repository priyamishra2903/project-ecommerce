'use strict';

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports['default'] = create;

var _http = require('http');

var _http2 = _interopRequireDefault(_http);

var _url = require('url');

var _libExtend = require('../lib/extend');

var _libExtend2 = _interopRequireDefault(_libExtend);

var _formatterJson = require('../formatter/json');

var _formatterJson2 = _interopRequireDefault(_formatterJson);

function create(url) {
  var opts = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];

  opts.method = opts.method || 'POST';
  opts.formatter = opts.formatter || _formatterJson2['default'];
  return function (entry) {
    if (opts.useBeacon) {
      return navigator.sendBeacon(url, opts.formatter(entry));
    }
    var req = _http2['default'].request((0, _libExtend2['default'])((0, _url.parse)(url), opts));
    req.end(opts.formatter(entry));
  };
}

module.exports = exports['default'];